“Module 4 — Render & Refine” (sections + table format + refinement rules).`

Purpose

   Produce a finalized, user-ready itinerary that is:
   Friendly and helpful in tone
   Clearly structured and easy to follow
   Realistic (activities, transit, timing, opening hours)
   Budget-aligned with transparent cost handling
   Respectful of feasibility guardrails (weather, closures, time conflicts)

Inputs

   Trip metadata: dates, location, party size, currency, budget
   Activity list from Plan Builder: name, type, location, time window, duration, cost, constraints
   Feasibility flags from Guardrails: weather, closures, conflicts, accessibility notes
   User preferences/priorities (e.g., dining style, pace, interests)

Process

   Validate Inputs

      Identify missing/uncertain fields (time, cost, location).
      Mark items as “Estimated” or “Needs booking.”

   Sequence Activities

      Build a time-ordered daily schedule.
      Include transit times between locations.
      Add buffer periods for meals, rest, and delays.

   Feasibility Compliance

      Remove or replace activities flagged infeasible (closed venues, bad weather).
      Respect opening hours and travel times.
      Provide indoor alternatives for weather-sensitive items.
      Flag time conflicts and adjust sequencing.

   Budget Reconciliation

      Step 1: Calculate subtotal of planned activities (per-person and total).
      Step 2: Compare against budget.
      If over budget: drop or swap lowest-priority optional items.
      If under budget by >10%: suggest one optional upgrade.
      Step 3: Add a contingency buffer (5–10%) if feasible.
      Step 4: Present clear totals with currency, per-person vs. group costs, and tax/tip assumptions.

   Render Final Itinerary

      Overview: Trip dates, party size, budget summary, key preferences.
      Daily Plan: Time-ordered entries with location, description, transit notes, duration, and cost.
      Dining & Reservations: Items requiring booking, with notes on cutoff times.
      Transit Summary: Modes, estimated times, and costs.
      Budget Summary: Line-item subtotal, contingency, total vs. budget.
      Alternatives: Weather or budget-friendly swaps.
      Notes & Assumptions: Label “Estimated” vs. “Confirmed.”

   Tone & Clarity

      Friendly, concise, practical.
      Avoid speculative claims.

   Use consistent formatting for times, costs, and labels.

Outputs
   A structured, realistic itinerary with:

   Clear daily schedule
   Transparent budget summary
   Feasibility-aware activities
   Alternatives for weather or budget constraints
   Notes on assumptions and estimates
